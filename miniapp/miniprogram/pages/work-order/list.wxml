<!--pages/work-order/list/list.wxml-->
<view class="work-order-list">
  <!-- 顶部标题栏 -->
  <view class="page-header">
    <text class="header-title">工单列表</text>
    <view class="header-count">共 {{total}} 个</view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-container">
      <text class="search-icon">🔍</text>
      <input 
        class="search-input" 
        placeholder="搜索工单号、车辆、客户"
        value="{{searchText}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
    </view>
  </view>

  <!-- 状态筛选 -->
  <view class="status-filter">
    <picker mode="selector" range="{{statusOptions}}" range-key="label" bindchange="onStatusChange" class="status-picker">
      <view class="picker-container">
        <text class="picker-label">状态筛选</text>
        <text class="picker-value">{{currentStatusLabel}}</text>
        <text class="picker-arrow">▼</text>
      </view>
    </picker>
  </view>

  <!-- 调试信息（可选，帮助诊断问题） -->
  <view style="display:none">
    <text>workOrders count: {{workOrders.length}}</text>
    <text>filteredOrders count: {{filteredOrders.length}}</text>
  </view>

  <!-- 工单列表容器 -->
  <view class="order-list">
    <!-- ✅ 修复版本：使用 filteredOrders 直接显示 -->
    <view wx:if="{{filteredOrders.length > 0}}">
      <!-- 遍历过滤后的工单列表 -->
      <block wx:for="{{filteredOrders}}" wx:key="id">
        <view class="order-card" data-id="{{item.id}}" bindtap="viewOrderDetail">
          <!-- ✅ 右上角状态徽章 - 使用预处理的颜色和文本字段 -->
          <view class="status-badge" style="background-color: {{item.statusColor}}">
            {{item.statusText}}
          </view>

          <!-- ✅ 车辆信息头部 - 大字加粗 -->
          <view class="vehicle-header">
            <text class="vehicle-icon">🚗</text>
            <text class="vehicle-text">{{item.vehicleInfo || item.vehicle_info || '未填写'}}</text>
          </view>

          <!-- 车主信息 -->
          <view class="order-description">
            <text class="desc-label">车主:</text>
            <text class="desc-text">{{item.customerName || item.customer_name || '未填写'}}</text>
          </view>

          <!-- 工单底部 - 费用和时间 -->
          <view class="order-footer">
            <view class="footer-item">
              <text class="footer-label">费用</text>
              <text class="footer-value price">¥ {{item.displayCost || item.actualCost || item.estimatedCost || '0.00'}}</text>
            </view>
            <view class="footer-item">
              <text class="footer-label">创建于</text>
              <text class="footer-value time">{{item.createdAt}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- 空状态提示 -->
    <view wx:if="{{filteredOrders.length === 0}}" class="empty-state">
      <text class="empty-icon">📋</text>
      <text class="empty-text">暂无工单</text>
      <text class="empty-hint">创建新工单或调整筛选条件</text>
    </view>
  </view>

  <!-- 创建工单浮动按钮 -->
  <button class="fab-button" bindtap="navigateToCreate">
    <text class="fab-icon">+</text>
  </button>
</view>
